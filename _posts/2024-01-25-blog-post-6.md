---
title: 'Ansible Refactoring, Assignments & Imports'
date: 2024-01-25
permalink: /posts/2024/01/blog-post-6/
tags:
  - cool posts
  - category1
  - category2
---

Andsible Refactoring and Static Assignments (Imports and Roles)
==========================

This blog post will focus on enhancing our Ansible code by working with the ansible-config-mgt repository. The goal is to refactor the code, create assignments, and explore the use of the imports functionality. This feature enables the effective reuse of previously developed playbooks in a new playbook, allowing for better organization of tasks and facilitating reuse when necessary.

As part of self-study, you can refer to the following source for a deeper understanding of Ansible artifacts reuse: ![](https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_reuse.html)

Code Refactoring is a common practice in computer programming, as described in ![](https://en.wikipedia.org/wiki/Code_refactoring). It involves making changes to the source code without altering the expected behavior of the software. The primary objective of refactoring is to improve code readability, enhance maintainability and extensibility, reduce complexity, and incorporate proper comments without affecting the logic.

In this case, the objective is to rearrange elements within the code, while ensuring that the overall state of the infrastructure remains unchanged.

Let's explore how you can elevate the quality of your Ansible code!

### 1. Jenkins Job Enhacement

Before we start, let's modify our Jenkins job. Currently, each new code change generates a distinct directory, which isn't ideal for running commands from a single location. Moreover, this approach consumes space on Jenkins servers (see below) with each subsequent change. To improve this, we'll introduce a new Jenkins project or job, and for this, we'll need to incorporate the Copy Artifact plugin (https://plugins.jenkins.io/copyartifact/).

![](/images/ansible/buildjobs.png)
*builds added anytime we make change to code, consuming space*

To begin, navigate to your Jenkins-Ansible server and establish a fresh directory named "ansible-config-artifact." This directory will serve as the storage location for all artifacts generated after each build.

`sudo mkdir /home/ubuntu/ansible-config-artifact` 

and then give permission so Jenkins could save files there 

`chmod -R 0777 /home/ubuntu/ansible-config-artifact`

Go to your Jenkins web console and install new plugin named **Copy Artifact.** Now, create a new Freestyle project and name it **save_aritfacts**.
The initiation of this project will be prompted upon the completion of your current Ansible project. Follow this configuration:

Now go to the save_artifacts General settings and tick **Discard old builds** and change as below:

![](/images/ansible/save_artifacts.png)

Then go to **Build Triggers** and do the change as below:

![](/images/ansible/save_artifacts_build_trigger.png)

